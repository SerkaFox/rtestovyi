!function(a){"use strict";function b(a){switch(a){case"listings":return g}}function c(b,c){"listings"===c&&(a(Estatik.settings.hfm_toggle_sidebar_selector).toggleClass("es-hidden","half_map"===b),a(document).trigger("listings_toggle_sidebar",{layout:b,entity_type:c}))}var d=new DOMParser,e={initSearch:function(){a(document).find("[data-search-form-selector]").each(function(){var c,d=a(a(this).data("search-form-selector")).not(".js-es-event-added"),e=a(this);d.length&&d.each(function(){a(this).addClass("js-es-search--ajax").addClass("js-es-event-added");var d=a(this).find("form");d.on("change","input:not([type=text]):not([type=search]),select",function(){var b=a(this),c=new f(e.find(".js-es-entities").data("hash"));"checkbox"===b.attr("type")&&c.delete(b.attr("name")),d.submit()}),d.on("focusout","input[type=text], input[type=number]",function(){d.submit()}),d.on("submit",function(){var g=e.find(".js-es-entities__wrap_inner"),h=d.serializeArray(),i=g.closest(".js-es-entities-wrap").find(".js-es-entities"),j=new f(i.data("hash"));if(j.clearQueryArguments(),h.length){var k={};h.forEach(function(a){a.value?(-1!==a.name.indexOf("[]")&&(k[a.name]=k[a.name]?k[a.name]:0,a.name=a.name.replace("[]","["+k[a.name]+++"]")),j.setValue(a.name,a.value)):j.delete(a.name)}),j.delete("prop_id"),j.setValue("page_num",1),j.setValue("paged-"+j.getValue("loop_uid"),1),j.setHistoryQuery()}i.data("hash",j.getHash()),c&&c.abort(),g.find(".js-es-entities").addClass("es-entities--loading");var l=i.data("entity"),m=b(l);return c=a.post(Estatik.settings.ajaxurl,{action:"get_"+l,hash:j.getHash(),reload_map:1},function(a){a=a||{},"success"===a.status&&m.append(a,g)},"json"),!1})})})},append:function(c,d,e){if("success"===c.status){var f=d.offset().top-+Estatik.settings.listings_offset_corrector,g=d.replaceWith(c.message);return b(g.find(".js-es-entities").data("entity")).init(g.closest(".js-es-entities-wrap")),e="undefined"===e||e,e&&a([document.documentElement,document.body]).animate({scrollTop:f||0},500),d.find(".js-es-entities").removeClass("es-entities--loading"),a(window).trigger("resize"),g}}},f=function(a,b){b=b||!1;var c=this;return this.hash=a,this.attributes=new URLSearchParams(decodeURIComponent(escape(window.atob(this.hash)))),b||(this.tempEntitiesHash=new f(a,!0)),this.shortcode_attributes=["layout","posts_per_page","disable_navbar","show_sort","show_total","show_page_title","show_layouts","limit","page_num","loop_uid","page_title","fields","collapsed_fields","main_fields","ignore_search","search_form_selector","enable_search","search_type","view_all_link_name","wishlist_confirm","view_all_page_id","disable_pagination","_ajax_mode","_ignore_coordinates","reload_map","hfm_full_width","ajax_response_mode","fields_delimiter","action","hash","prop_id","enable_ajax","strict_address","map_show","authors"],f.prototype.clearQueryArguments=function(){var a=this,b=this.tempEntitiesHash,c=Estatik.search.fields;this.tempEntitiesHash.getAttributes().forEach(function(d,e){b.shortcode_attributes.includes(e)||c.includes(e)||a.delete(e)})},f.prototype.getValue=function(a){return c.attributes.get(a)},f.prototype.getAllValues=function(a){return c.attributes.getAll(a)},f.prototype.setValue=function(a,b){return c.attributes.set(a,b),c.hash=btoa(c.attributes.toString()),c},f.prototype.delete=function(a){return c.attributes.delete(a),c.hash=btoa(c.attributes.toString()),c},f.prototype.getHash=function(){return c.hash},f.prototype.getAttributes=function(){return this.attributes},f.prototype.toString=function(){return this.getHash()},f.prototype.setHistoryQuery=function(){var a=this.getAttributes(),b=this.tempEntitiesHash;b.getAttributes().forEach(function(c,d){b.shortcode_attributes.forEach(function(b,c){d.includes(b)&&"layout"!=d&&a.delete(d)})});var c=decodeURIComponent(window.location.pathname+"?"+a.toString());window.history.replaceState({},"",c)},this};window.EstatikEntitiesHash=f;var g={halfMapInstances:[],init:function(){setTimeout(function(){g.initCarousel()},10)},getLayoutEntityType:function(){return"listings"},append:function(a,b,c){if("success"===a.status&&(e.append(a,b,c),+a.reload_map&&a.loop_uid)){var d=g.halfMapInstances[a.loop_uid];d&&(a.coordinates?d.setMarkers(a.coordinates):d.deleteMarkers())}},getLayoutClass:function(a){for(var b=1;b<10;b++){if(a.hasClass("es-listings--grid-"+b))return"es-listings--grid-"+b;if(a.hasClass("es-listings--grid-"+b))return"es-listings--grid-"+b}return"es-listings--list"},initCarousel:function(b,c){c=c||a(document),a(".js-es-slick.slick-initialized",c).slick("unslick"),a(".js-es-slick",c).each(function(){var c=a(this).data("slick")||{},d=c.slidesToShow||1,e=c.vertical||!1,f=!1;if(void 0!==c.infinite&&(c.infinite=Boolean(c.infinite)),c.rtl=Estatik.settings.is_rtl,e)a(this).hasClass("slick-initialized")||(f=a(this));else if(!a(this).hasClass("slick-initialized")){var h=a(this).width(),i=parseInt(h/230)||1;f=a(this),c.slidesToShow=d<=i?d:i}f&&(f.on("init",function(){f.removeClass("slick-hidden")}).slick(c),f.find(".js-es-slick").length&&f.on("beforeChange",function(c,d,e,h){a(d.$list).find(".js-es-slick:not(.slick-initialized)").length&&g.initCarousel(b,f)}))})}};window.EstatikProperties=g;var h=function(b){this.$wrapper=b,this.mapInstance=null,this.markers=[],this.clusters=[],this.load_first_time=!0,this.ignoreLoadListingsByBounds=!0;var c=this;h.prototype.init=function(){if(this.setFullWidth(),"undefined"==typeof google)return!1;this.$map=a(".js-es-map",c.$wrapper),this.map=c.$map[0],this.mapInstance=new google.maps.Map(c.map,{draggable:!0,zoom:16,mapId:c.map.id}),this.setMarkers(c.$map.data("listings")),this.mapInstance.addListener("click",function(){c.close_popups()}),a(window).on("resize",function(){c.setFullWidth()}),c.mapInstance.addListener("zoom_changed",function(){if(c.load_first_time||c.ignoreZoomHandler)return c.load_first_time=!1,!1;c.close_popups(),c.loadListingsFromVisibleBounds()}),c.mapInstance.addListener("dragend",function(){c.loadListingsFromVisibleBounds()})},h.prototype.setFullWidth=function(){if(this.$wrapper.hasClass("es-properties--hfm")&&this.$wrapper.hasClass("es-properties--hfm--full-width")){this.$wrapper.css("margin-left",0);var a=this.$wrapper[0].getBoundingClientRect(),b=a.left;this.$wrapper.css("margin-left",-b+"px")}},h.prototype.loadListingsFromVisibleBounds=function(){if(c.ignoreLoadListingsByBounds)return!1;if("undefined"==typeof google)return!1;var b=[],d=c.mapInstance.getBounds();if(c.markers.length){for(var e in c.markers){var h=c.markers[e].position;void 0!==d&&d.contains(h)&&b.push(c.markers[e].post_id)}b.length||b.push(-1);var i=new f(c.$wrapper.find(".js-es-listings").data("hash"));i.setValue("prop_id",b.join(",")),i.setValue("page_num",1),i.setValue("paged-"+i.getValue("loop_uid"),1),void 0!==c.xhr&&c.xhr.abort(),c.$wrapper.find(".js-es-listings").addClass("es-listings--loading"),c.xhr=a.post(Estatik.settings.ajaxurl,{reload_map:0,hash:i.getHash(),action:"get_listings"},function(a){g.append(a,c.$wrapper.find(".js-es-entities__wrap_inner"),!1)},"json")}},a(c.$wrapper).on("mouseenter",".js-es-listing",function(){var b=a(this).data("post-id"),e=c.findMarkerByPostID(b);if(e){var f=e.marker_svg;if(f){f=f.replaceAll("data-color",'style="fill: '+Estatik.settings.main_color+'"');var g=d.parseFromString(f,"image/svg+xml").documentElement;e.content=g}}}),a(c.$wrapper).on("mouseleave",".js-es-listing",function(){var b=a(this).data("post-id"),e=c.findMarkerByPostID(b);if(e){var f=e.marker_svg;if(f){f=f.replaceAll("data-color",'style="fill: '+e.marker_color+'"');var g=d.parseFromString(f,"image/svg+xml").documentElement;e.content=g}}}),h.prototype.deleteMarkers=function(){if("undefined"==typeof google)return!1;if(c.clusters.length)for(var a in c.clusters)c.clusters.hasOwnProperty(a)&&c.clusters[a].clearMarkers();if(c.markers.length)for(var b in c.markers)c.markers.hasOwnProperty(b)&&c.markers[b].setMap(null);c.markers=null,c.markers=[]},h.prototype.findMarkerByPostID=function(a){return c.markers.find(function(b){return b.post_id===a})},h.prototype.setMarkers=function(a){if("undefined"==typeof google)return!1;c.ignoreLoadListingsByBounds=!0;var b,e=new google.maps.LatLngBounds;if(c.$map.data("listings",a),c.deleteMarkers(),a){for(var f in a)if(a.hasOwnProperty(f)){var g=new google.maps.LatLng(parseFloat(a[f].lat),parseFloat(a[f].lng));e.extend(g),b={position:g,map:c.mapInstance,zIndex:99};var i=null,j=null;void 0!==a[f].marker?(i=Estatik.settings.map_marker_icons[a[f].marker],j=a[f].marker_color):(i=Estatik.settings.map_marker_icons[Estatik.settings.map_marker_icon],j=Estatik.settings.map_marker_color);var k=i.replaceAll("data-color",'style="fill: '+j+'"'),l=d.parseFromString(k,"image/svg+xml").documentElement;b.content=l,b=new google.maps.marker.AdvancedMarkerElement(b),b.marker_svg=i,b.marker_color=j,b.post_id=a[f].post_id,google.maps.event.addListener(b,"gmp-click",c.propertyPopup(g,a[f])),c.findMarkerByPostID(b.post_id)||c.markers.push(b)}if(void 0!==Estatik.settings.default_lat_lng){var m=Estatik.settings.default_lat_lng;c.mapInstance.setCenter({lat:+m[0],lng:+m[1]}),Estatik.settings.map_zoom&&c.mapInstance.setZoom(+Estatik.settings.map_zoom)}else void 0!==e&&(c.mapInstance.fitBounds(e),c.mapInstance.panToBounds(e));if(c.markers&&Estatik.settings.is_cluster_enabled){var n=[{textColor:"white"}];"cluster3"===Estatik.settings.map_cluster_icon&&(n[0].textColor=Estatik.settings.map_cluster_color),+Estatik.settings.is_cluster_enabled&&"price"!==Estatik.settings.map_marker_type&&c.clusters.push(new markerClusterer.MarkerClusterer({map:c.mapInstance,markers:c.markers,maxZoom:12,renderer:{render:function(a){return new google.maps.marker.AdvancedMarkerElement({map:c.mapInstance,position:a.position,content:h.getClusterIcon({number:a.count,textColor:n[0].textColor,textSize:10})})}}}))}}c.ignoreLoadListingsByBounds=!1},h.prototype.propertyPopup=function(b,d){return function(){var b={post_id:d.post_id,action:"es_get_property_item"};void 0!==c.xhr&&c.xhr.abort(),c.close_popups(),c.xhr=a.post(Estatik.settings.ajaxurl,b,function(b){if(b=b||{},d.content=b.content,d.position=new google.maps.LatLng(d.lat,d.lng),"success"===b.status){var e=new EsGoogleMapPopup(d);c.mapInstance.setCenter(d.position),e.setMap(c.mapInstance),e.getMap().panToWithOffset(d.position,0,120),setTimeout(function(){g.initCarousel(a(c.mapInstance.getDiv()))},100)}},"json")}},h.prototype.close_popups=function(){var a=c.mapInstance.getDiv().querySelector(".es-map-popup");a&&a.remove()},h.getClusterIcon=function(a){var b=a.color||Estatik.settings.map_cluster_color,c=Estatik.settings.map_cluster_icons[Estatik.settings.map_cluster_icon];return c=c.replaceAll("data-color",'style="fill:'+b+'"').replaceAll("data-hide",'style="fill:#ffffff"').replaceAll("{text}",'<text x="50%" y="50%" font-size="'+a.textSize+'px" dominant-baseline="middle" text-anchor="middle" fill="'+a.textColor+'">'+a.number+"</text>"),d.parseFromString(c,"image/svg+xml").documentElement}};window.EstatikHalfMap=h,a(function(){g.init(),e.initSearch(),a(".js-es-properties__map.es-properties__map--visible").each(function(){var b=a(this).closest(".js-es-properties"),d=new h(b),e=b.find(".js-es-listings"),i=new f(e.data("hash"));g.halfMapInstances[i.getValue("loop_uid")]=d,d&&(d.init(),c("half_map","listings"))}),a(document).on("click",".js-es-entities-filter-item",function(c){var d=a(this),e=d.data("query");if(e&&Object.keys(e).length){var g=d.closest(".js-es-entities-wrap").find(".js-es-entities"),h=d.closest(".js-es-entities-wrap").find(".js-es-entities__wrap_inner"),i=g.data("entity"),j=b(i),k=new f(g.data("hash"));Object.entries(e).forEach(function(a){k.setValue(a[0],a[1])}),k.setHistoryQuery();var l={action:"get_"+i,hash:k.getHash(),reload_map:1};a.post(Estatik.settings.ajaxurl,l,function(a){j.append(a,h)},"json")}return c.preventDefault(),!1}),a(document).on("click",".js-es-change-layout",function(){if(!a(this).hasClass("es-btn--active")){var d=a(this).data("layout"),e=a(this).closest(".js-es-control--layouts"),i=a(this).closest(".js-es-entities-wrap"),j=i.find(".js-es-entities"),k=j.data("entity"),l=b(k),m=l.getLayoutClass(j);i.removeClass("es-properties--hfm");var n=new f(j.data("hash")),o=n.getValue("loop_uid");n.setValue("layout",d),n.setHistoryQuery(),e.find(".js-es-change-layout").removeClass("es-btn--active"),a(this).addClass("es-btn--active");var p=d;if("half_map"===d){i.find(".js-es-properties__map").addClass("es-properties__map--visible"),i.addClass("es-properties--hfm");var q=new h(i);g.halfMapInstances[o]=q,q&&q.init(),d=Estatik.settings.grid_layout}else{var r=i.find(".js-es-properties__map");r.length&&(r.removeClass("es-properties__map--visible"),i.css({"margin-left":"-15px"}))}Estatik.settings.hfm_toggle_sidebar&&Estatik.settings.hfm_toggle_sidebar_selector&&c(p,k);var s=l.getLayoutEntityType();j.removeClass(m).addClass("es-"+s+"--"+d).data("layout","es-"+s+"--"+d),j.data("hash",n.getHash()),l.init(),a(window).trigger("resize")}return!1}),a(document).on("click",".js-es-pagination a.page-numbers",function(){var c=a(this).closest(".es-pagination");if(!c.find(".page-numbers--preload").length){var d=c.closest(".es-properties--hfm").length,e=a(this).data("page-number"),g=a(this).closest(".js-es-entities__wrap_inner"),h=g.find(".js-es-entities");h.addClass("es-entities--loading");var i=new f(h.data("hash")),j=h.data("entity"),k=b(j),l={reload_map:d,action:"get_"+j,hash:i.setValue("page_num",e).getHash()},m=i.getValue("loop_uid"),n=g.find(".js-es-sort").val();i.setValue("paged-"+m,e),n&&(i.setValue("sort-"+m,n),i.setValue("sort",n)),i.setHistoryQuery(),a(this).addClass("page-numbers--preload"),c.addClass("es-pagination--disabled"),a.post(Estatik.settings.ajaxurl,l,function(a){k.append(a,g,!0)},"json")}return!1}),a(document).on("change",".js-es-sort",function(){var c=a(this),d=c.closest(".js-es-entities__wrap_inner");if(d.length){c.prop("disabled","disabled");var e=d.find(".js-es-entities");e.addClass("es-entities--loading");var g=new f(e.data("hash")),h=g.getValue("loop_uid"),i=c.val();i&&(g.setValue("sort-"+h,i),g.setValue("sort",i)),g.setValue("page_num",1),g.setValue("paged-"+h,1),g.setHistoryQuery();var j=e.data("entity"),k=b(j),l={action:"get_"+j,hash:g.getHash(),reload_map:1};a.post(Estatik.settings.ajaxurl,l,function(a){k.append(a,d)},"json").always(function(){c.removeProp("disabled").removeAttr("disabled")})}}),a(document).on("click",".js-es-remove-filters",function(){a(this).addClass("es-btn--preload").attr("disabled","disabled").prop("disabled","disabled");var b=a(this).closest(".js-es-entities-wrap");return b.find(".js-es-address").val(""),b.find(".js-es-search-nav__item").find('input[type!="reset"][type!="button"][type!="submit"],select').each(function(){var b=a(this),c=a(this).prop("type");if("radio"===c||"checkbox"===c){b.removeProp("checked").removeAttr("checked");var d=a(this).closest(".js-search-field-container").find('input[value=""]');d.length&&d.prop("checked","checked")}else a(this).hasClass("select2-hidden-accessible")?"select-one"===c?a(this).val("").trigger("change"):a(this).val([]).trigger("change"):a(this).val("")}),b.find(".js-es-search form").trigger("submit"),!1})})}(jQuery);